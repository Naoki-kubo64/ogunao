<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¾æˆ¦BGMãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            height: 150px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .volume-control {
            margin: 10px 0;
        }
        .status {
            padding: 5px 10px;
            border-radius: 3px;
            margin: 5px 0;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <!-- BGMç”¨ã®audioè¦ç´  -->
    <audio id="title-bgm" preload="auto" loop>
        <source src="music/instrumental.mp3" type="audio/mpeg">
    </audio>
    <audio id="game-bgm" preload="auto" loop>
        <source src="music/ã·ã‚ˆã·ã‚ˆã£ã¨å§‹ã¾ã‚‹æ¯æ—¥.mp3" type="audio/mpeg">
    </audio>
    <audio id="game-bgm-2" preload="auto" loop>
        <source src="music/2.mp3" type="audio/mpeg">
    </audio>
    <audio id="naochan-bgm" preload="auto" loop>
        <source src="music/jagler1.mp3" type="audio/mpeg">
    </audio>
    <audio id="battle-bgm" preload="auto" loop>
        <source src="music/battleBGM.MP3" type="audio/mpeg">
    </audio>

    <div class="test-container">
        <h1>ğŸµ å¯¾æˆ¦ãƒ¢ãƒ¼ãƒ‰BGMãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="test-section">
            <h3>ğŸ”§ BGMè¦ç´ çŠ¶æ…‹ç¢ºèª</h3>
            <div id="element-status"></div>
            <button onclick="checkBgmElements()">BGMè¦ç´ ãƒã‚§ãƒƒã‚¯</button>
        </div>

        <div class="test-section">
            <h3>ğŸ® BGMåˆ¶å¾¡ãƒ†ã‚¹ãƒˆ</h3>
            <div class="volume-control">
                <label for="test-volume">BGMéŸ³é‡:</label>
                <input type="range" id="test-volume" min="0" max="100" value="50">
                <span id="volume-display">50%</span>
            </div>
            
            <button onclick="playTitleBgm()">ã‚¿ã‚¤ãƒˆãƒ«BGMå†ç”Ÿ</button>
            <button onclick="playGameBgm()">ã‚²ãƒ¼ãƒ BGMå†ç”Ÿ</button>
            <button onclick="playBattleBgm()">å¯¾æˆ¦BGMå†ç”Ÿ</button>
            <button onclick="stopAllBgm()">å…¨BGMåœæ­¢</button>
        </div>

        <div class="test-section">
            <h3>ğŸ¯ å¯¾æˆ¦ãƒ¢ãƒ¼ãƒ‰é·ç§»ãƒ†ã‚¹ãƒˆ</h3>
            <button onclick="simulateBattleStart()">å¯¾æˆ¦é–‹å§‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
            <button onclick="simulateBattleEnd()">å¯¾æˆ¦çµ‚äº†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š ç¾åœ¨ã®çŠ¶æ…‹</h3>
            <div id="current-status"></div>
            <button onclick="updateStatus()">çŠ¶æ…‹æ›´æ–°</button>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ ãƒ­ã‚°</h3>
            <div id="log" class="log"></div>
            <button onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
        </div>
    </div>

    <script>
        let currentBgm = null;
        
        // ãƒ­ã‚°é–¢æ•°
        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            logElement.textContent += logEntry;
            logElement.scrollTop = logElement.scrollHeight;
            
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('log').textContent = '';
        }
        
        // éŸ³é‡ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
        const volumeSlider = document.getElementById('test-volume');
        const volumeDisplay = document.getElementById('volume-display');
        
        volumeSlider.addEventListener('input', (e) => {
            const volume = e.target.value;
            volumeDisplay.textContent = `${volume}%`;
            updateAllBgmVolume(volume / 100);
        });
        
        function updateAllBgmVolume(volume) {
            const bgmElements = ['title-bgm', 'game-bgm', 'game-bgm-2', 'naochan-bgm', 'battle-bgm'];
            bgmElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.volume = volume;
                }
            });
            log(`ğŸ”Š å…¨BGMéŸ³é‡ã‚’${Math.round(volume * 100)}%ã«è¨­å®š`);
        }
        
        // BGMè¦ç´ ãƒã‚§ãƒƒã‚¯
        function checkBgmElements() {
            const statusDiv = document.getElementById('element-status');
            const bgmElements = ['title-bgm', 'game-bgm', 'game-bgm-2', 'naochan-bgm', 'battle-bgm'];
            
            let html = '';
            bgmElements.forEach(id => {
                const element = document.getElementById(id);
                const exists = element !== null;
                const canPlay = exists && element.readyState >= 1;
                const statusClass = exists ? (canPlay ? 'success' : 'info') : 'error';
                
                html += `<div class="status ${statusClass}">
                    ${id}: ${exists ? 'âœ…' : 'âŒ'} å­˜åœ¨ | ${canPlay ? 'âœ…' : 'âŒ'} å†ç”Ÿå¯èƒ½
                </div>`;
                
                log(`${id}: å­˜åœ¨=${exists}, å†ç”Ÿå¯èƒ½=${canPlay}`);
            });
            
            statusDiv.innerHTML = html;
        }
        
        // BGMåˆ¶å¾¡é–¢æ•°
        function stopAllBgm() {
            const bgmElements = ['title-bgm', 'game-bgm', 'game-bgm-2', 'naochan-bgm', 'battle-bgm'];
            
            bgmElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.pause();
                    element.currentTime = 0;
                }
            });
            
            currentBgm = null;
            log('ğŸ”‡ å…¨ã¦ã®BGMã‚’åœæ­¢');
            updateStatus();
        }
        
        function playTitleBgm() {
            stopAllBgm();
            const titleBgm = document.getElementById('title-bgm');
            if (titleBgm) {
                titleBgm.play().then(() => {
                    currentBgm = titleBgm;
                    log('ğŸµ ã‚¿ã‚¤ãƒˆãƒ«BGMé–‹å§‹æˆåŠŸ');
                    updateStatus();
                }).catch(e => {
                    log(`âŒ ã‚¿ã‚¤ãƒˆãƒ«BGMå†ç”Ÿå¤±æ•—: ${e.message}`, 'error');
                });
            } else {
                log('âŒ title-bgmè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
            }
        }
        
        function playGameBgm() {
            stopAllBgm();
            const gameBgm = document.getElementById('game-bgm');
            if (gameBgm) {
                gameBgm.play().then(() => {
                    currentBgm = gameBgm;
                    log('ğŸµ ã‚²ãƒ¼ãƒ BGMé–‹å§‹æˆåŠŸ');
                    updateStatus();
                }).catch(e => {
                    log(`âŒ ã‚²ãƒ¼ãƒ BGMå†ç”Ÿå¤±æ•—: ${e.message}`, 'error');
                });
            } else {
                log('âŒ game-bgmè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
            }
        }
        
        function playBattleBgm() {
            stopAllBgm();
            const battleBgm = document.getElementById('battle-bgm');
            if (battleBgm) {
                battleBgm.currentTime = 0;
                const volume = volumeSlider.value / 100;
                battleBgm.volume = volume;
                
                battleBgm.play().then(() => {
                    currentBgm = battleBgm;
                    log(`âœ… å¯¾æˆ¦BGMé–‹å§‹æˆåŠŸ (éŸ³é‡: ${Math.round(volume * 100)}%)`);
                    updateStatus();
                }).catch(e => {
                    log(`âŒ å¯¾æˆ¦BGMå†ç”Ÿå¤±æ•—: ${e.message}`, 'error');
                    // ãƒªãƒˆãƒ©ã‚¤
                    setTimeout(() => {
                        battleBgm.play().then(() => {
                            currentBgm = battleBgm;
                            log('âœ… å¯¾æˆ¦BGMå†ç”Ÿãƒªãƒˆãƒ©ã‚¤æˆåŠŸ');
                            updateStatus();
                        }).catch(e2 => {
                            log(`âŒ å¯¾æˆ¦BGMå†ç”Ÿãƒªãƒˆãƒ©ã‚¤ã‚‚å¤±æ•—: ${e2.message}`, 'error');
                        });
                    }, 500);
                });
            } else {
                log('âŒ battle-bgmè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'error');
            }
        }
        
        // å¯¾æˆ¦ãƒ¢ãƒ¼ãƒ‰ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
        function simulateBattleStart() {
            log('ğŸ® å¯¾æˆ¦é–‹å§‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆé–‹å§‹');
            
            // 1. å…¨BGMåœæ­¢
            stopAllBgm();
            
            // 2. å¯¾æˆ¦BGMé–‹å§‹
            setTimeout(() => {
                playBattleBgm();
            }, 100);
        }
        
        function simulateBattleEnd() {
            log('ğŸ å¯¾æˆ¦çµ‚äº†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ');
            stopAllBgm();
            
            // ã‚¿ã‚¤ãƒˆãƒ«BGMã«æˆ»ã™
            setTimeout(() => {
                playTitleBgm();
            }, 500);
        }
        
        // çŠ¶æ…‹æ›´æ–°
        function updateStatus() {
            const statusDiv = document.getElementById('current-status');
            let html = '';
            
            if (currentBgm) {
                const id = currentBgm.id;
                const isPlaying = !currentBgm.paused;
                const volume = Math.round(currentBgm.volume * 100);
                const currentTime = Math.round(currentBgm.currentTime);
                
                html = `<div class="status ${isPlaying ? 'success' : 'info'}">
                    ç¾åœ¨ã®BGM: ${id}<br>
                    çŠ¶æ…‹: ${isPlaying ? 'å†ç”Ÿä¸­' : 'åœæ­¢'}<br>
                    éŸ³é‡: ${volume}%<br>
                    å†ç”Ÿæ™‚é–“: ${currentTime}ç§’
                </div>`;
            } else {
                html = '<div class="status info">BGMã¯å†ç”Ÿã•ã‚Œã¦ã„ã¾ã›ã‚“</div>';
            }
            
            statusDiv.innerHTML = html;
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸš€ å¯¾æˆ¦BGMãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸åˆæœŸåŒ–å®Œäº†');
            checkBgmElements();
            updateStatus();
            updateAllBgmVolume(0.5);
        });
        
        // å®šæœŸçš„ãªçŠ¶æ…‹æ›´æ–°
        setInterval(updateStatus, 1000);
    </script>
</body>
</html>